    
------------------TABLES------------------

CREATE TABLE CITY_N1N2N3 (
        CITY VARCHAR(9) NOT NULL,
        NAME1 VARCHAR(9),
        NAME2 VARCHAR(9),
        NAME3 VARCHAR(9)
);

CREATE TABLE CITY_NAME
        LIKE CITY_NAMES;

CREATE TABLE CITY_NAMES (
        CITY VARCHAR(9) NOT NULL,
        NAMES VARCHAR(30)
);

INSERT INTO CITY_NAMES
VALUES
('Minsk', 'Johny,Peter,Stacy'),
('Gomel', 'Tomas,Jacky');


------------------TASK 1------------------

CREATE FUNCTION getFirst (NAMES VARCHAR(30))
  RETURNS VARCHAR(9)
  LANGUAGE SQL
  CONTAINS SQL
  NO EXTERNAL ACTION
  DETERMINISTIC
  RETURN CASE SUBSTR(NAMES, 1, 5)
                        WHEN '' THEN 'NOBODY'
                        ELSE SUBSTR(NAMES, 1, 5)
                        END                        
           
                        
CREATE FUNCTION getSecond (NAMES VARCHAR(30))
  RETURNS VARCHAR(9)
  LANGUAGE SQL
  CONTAINS SQL
  NO EXTERNAL ACTION
  DETERMINISTIC
  RETURN CASE SUBSTR(NAMES, 7, 5)
                        WHEN '' THEN 'NOBODY'
                        ELSE SUBSTR(NAMES, 7, 5)
                        END
                        

CREATE FUNCTION getThird (NAMES VARCHAR(30))
  RETURNS VARCHAR(9)
  LANGUAGE SQL
  CONTAINS SQL
  NO EXTERNAL ACTION
  DETERMINISTIC
  RETURN CASE SUBSTR(NAMES, 13, 5)
                        WHEN '' THEN 'NOBODY'
                        ELSE SUBSTR(NAMES, 13, 5)
                        END
               

SELECT CITY, getFirst(NAMES) AS NAME1, getSecond(NAMES) AS NAME2, getThird(NAMES) AS NAME2
FROM CITY_NAMES;         

INSERT INTO CITY_N1N2N3
SELECT CITY, getFirst(NAMES) AS NAME1, getSecond(NAMES) AS NAME2, getThird(NAMES) AS NAME2
FROM CITY_NAMES;

SELECT * FROM CITY_NAMES;


------------------TASK 2------------------

CREATE FUNCTION CITY_N1N2N3_TO_CITY_NAME () 
RETURNS TABLE (CITY VARCHAR(9),
                NAME VARCHAR(9))
LANGUAGE SQL
READS SQL DATA
NO EXTERNAL ACTION
DETERMINISTIC
RETURN
 SELECT CITY, NAME1 as NAME FROM CITY_N1N2N3
 UNION ALL
 SELECT CITY, NAME2 as NAME FROM CITY_N1N2N3
 UNION ALL
 SELECT CITY, NAME3 as NAME FROM CITY_N1N2N3
 WHERE NAME1 NOT IN ('NOBODY') 
         AND NAME2 NOT IN ('NOBODY') 
	 AND NAME3 NOT IN ('NOBODY') 


SELECT *
FROM TABLE (CITY_N1N2N3_TO_CITY_NAME()) AS CITY_NAME
ORDER BY 1 DESC;

INSERT INTO CITY_NAME
SELECT *
FROM TABLE (CITY_N1N2N3_TO_CITY_NAME())
ORDER BY 1 DESC;

SELECT * FROM CITY_NAME;
